---
title: JVM内存模型
date: 2021-1-7 09:05:59 +0800
categories: [JVM, 内存模型]
tags: [JAVA, JVM, 内存模型]
math: true
image: 
---

### JAVA跨平台特性



### JAVA整体结构&内存模型

- JVM虚拟机

  - 类装载子系统

  - 运行时数据区

    - 方法区

      jdk>=1.8叫元空间,jdk<1.8叫永久代，默认初始大小21M，最大值是无限大，直到使用完所有内存。当存放的类信息存满方法区时，会发生full GC。

      元空间大小有动态扩容机制。

      - 常量

      - 静态变量

        存放静态变量对象在堆中的内存地址。

      - 类信息

    - 堆

      - 年轻代  默认1/3

        - Eden  8/10

          内存满时，发生minor GC，回收Eden区和不为空的Survivor区，然后将非垃圾对象放入另一个Survivor区，当一个对象被放入Survivor区时，对象的分代年龄会加1，默认配置下，当对象的分代年龄到达15，该对象进入old区，老年代区。

        - Survivor区

          - s0  1/10  
          - s1  1/10

      - 老年代  默认2/3

        内存满时，发生full GC，回收整个堆，回收之后还没有空间放入对象，发生OOM。

        发生GC时，会STW，Stop The World，停止用户所有线程，开始GC。

        JVM调优主要分析系统运行的内存情况，通过各种JVM参数配置，最终减少full GC。

        STW是为了收集垃圾对象更简单，如果不STW，有可能搜集的非垃圾对象所在的方法已经出栈，这些非垃圾对象可能已经变为垃圾对象，同理那些垃圾对象也可能已经变为非垃圾对象。

    - 栈

      -Xss	设置值越小，一个线程栈里面可分配的栈帧越少，但整个JVM可以开启更多的线程。有时候发生StackOverflowError，不是-Xss值太小，而是-Xss太大。

      默认大小1M，当方法嵌套调用时，有可能会超出栈大小，发生StackOverflowError。

      - 栈帧

        - 局部变量表

          存放对象的内存地址，指向对象在堆中的内存地址。

        - 操作数栈

          在程序运行过程中，暂存将要操作的数据值。

        - 动态链接

          在程序运行过程中，将符号引用替换为直接引用。将方法替换为

        - 方法出口

    - 本地方法栈

      native本地方法运行时需要的内存空间。

    - 程序计数器

      在多线程情况下，记录当前线程执行代码位置，当线程被挂起再切换回来继续从这个位置执行代码。

    - 栈、本地方法栈、程序计数器是线程独有的，也就是每个线程都有这些内存空间，而方法区和堆是线程共享的。

  - 字节码执行引擎



### JVM内存参数设置

