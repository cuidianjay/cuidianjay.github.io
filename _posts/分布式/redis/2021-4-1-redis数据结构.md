---
title: redis数据结构
date: 2021-4-1 13:39:56 +0800
categories: [分布式, Redis]
tags: [分布式, Redis, 数据结构]
math: true
image: 
---

### Redis数据结构

#### String字符串

##### 应用场景

1. 单值缓存

   ~~~shell
   set key value
   get key
   ~~~

2. 对象缓存

   ~~~shell
   #1.简单
   set user:1 value(json格式数据)
   #2.可以对对象单个属性修改
   mset user:1:name xx user:1:age 18
   mget user:1:name user:1:age
   ~~~

3. 分布式锁

   ~~~shell
   #1.简易分布式锁
   setnx lock:1000 true
   #2.设置超时时间
   set lock:1000 true ex 10 nx
   ~~~

   

4. 计数器

   比如文章阅读量

   ~~~shell
   #1.自增
   incr art:count:id
   get art:count:id
   ~~~

   

5. Web集群Session共享

   Spring Session + Redis实现Session共享

6. 分布式系统全局系列号

   ~~~shell
   #简易批量生成序列号
   incrby id 1000
   ~~~

   

#### Hash哈希

##### 应用场景

1. 对象缓存

   ~~~shell
   hmset user:1 name xx age 18
   OK
   hmget user:1 name
   1) "xx"
   hmget user:1 name age
   1) "xx"
   2) "18"
   ~~~

   > 当一个对象集合太大时，就不能把所有对象都放在一个hash key里面了，这种bigkey会阻塞redis其他命令，因为redis是单线程模型。
   >
   > 可采用分段保存方式解决。

2. 购物车

   ~~~shell
   #hset user:{userId} {productId} {count}
   #添加商品
   hset user:100 10001 1
   #增加数量
   hincrby user:100 10001 1
   #商品总数
   hlen user:100
   #删除商品
   hdel user:100 10001
   #获取购物车所有商品
   hgetall user:100
   ~~~

##### 优点

1. 同类数据整合存储，方便数据管理
2. 相比String操作消耗内存与Cpu更小
3. 相比String更节省存储空间

##### 缺点

1. Redis集群架构下不适合大规模使用

   将所有数据放在一个redis分片上，造成数据倾斜，单个分片访问压力变大。可采用分段保存方式解决。

2. 过期功能只能作用于key上



#### List

##### 常用命令

~~~shell
Lpush k v[v ...] #将一个或多个value插入key列表的最左边
Rpush k v[v ...] #将一个或多个value插入key列表的最右边
Lpop k #从key列表最左边开始移除并返回元素
Rpop k #从key列表最右边边开始移除并返回元素
Lrange k start stop #返回key列表指定区间内的元素
#从key列表最左边弹出一个元素，若列表中没有元素则一直阻塞等待timeout秒，timeout=0，一直阻塞
blpop k[k ...] timeout 
#从key列表最右边弹出一个元素，若列表中没有元素则一直阻塞等待timeout秒，timeout=0，一直阻塞
brpop k[k ...] timeout
~~~

##### 常用数据结构

1. Stack(栈) = Lpush + Lpop = FILO(先进后出)
2. Queue(队列) = Lpush + Rpop = FIFO(先进先出)
3. Blocking MQ(阻塞队列) = Lpush + BRpop

##### 应用场景

1. 消息流

   微博消息或者微信公众号消息

   1. pull方式

      将大V的消息发送到大V的队列中，所有订阅的用户去pull拉取队列中的消息，然后再根据时间排序。

      省空间，用户拉取逻辑稍复杂。

   2. push方式

      将用户订阅的消息发送到用户的队列中，推送给用户。

      推送逻辑简单，占用空间。

#### Set集合

##### 常用命令

~~~shell
SADD key member [member ...] #往集合key中存入元素，元素存在则忽略，若key不存在则新建
SREM key member [member ...] #从集合key中删除元素
SMEMBERS key #获取集合key中所有元素
SCARD key #获取集合key的元素个数
SISMEMBER key member #判断member元素是否存在于集合key中
SRANDMEMBER key [count] #从集合key中选出count个元素，元素不从key中删除
SPOP key [count] #从集合key中选出count个元素，元素从key中删除

#Set运算操作
SINTER key [key ...] #交集运算
SINTERSTORE destination key [key ..] #将交集结果存入新集合destination中
SUNION key [key ..] #并集运算
SUNIONSTORE destination key [key ...] #将并集结果存入新集合destination中
SDIFF key [key ...] #差集运算
SDIFFSTORE destination key [key ...] #将差集结果存入新集合destination中
~~~

##### 应用场景

1. 抽奖

   ~~~shell
   # 参与抽奖加入集合
   sadd key {userId}
   # 查看所有参与抽奖用户
   smembers key
   # 抽奖
   srandmember key [count] / Spop key[count]
   ~~~

   

2. 

3. 

### 知识点

#### redis.conf配置

1. daemonize yes

   开启后台启动

2. redis-server redis.conf

   指定配置文件启动redis服务端

3. redis-cli

   启动redis客户端连接redis

4. 

