---
title: Redis架构
date: 2021-4-2 15:22:08 +0800
categories: [分布式, Redis]
tags: [分布式, Redis, 架构]
math: true
image: 
---

### 主从架构

#### 配置

1. ~~~shell
   # bind 127.0.0.1 (bind绑定的是自己机器网卡的ip，如果有多块网卡可以配多个ip，代表允许客户端通 过机器的哪些网卡ip去访问，内网一般可以不配置bind，注释掉即可)
   ~~~

2. 

#### 工作原理

##### 全量复制



##### 部分复制（断点续传）



#### 主从复制风暴





#### 管道

非原子性

#### Lua脚本

具有事务特性



### Sentinel哨兵架构

#### 配置



#### 工作原理



### Cluster集群架构



#### Redis集群方案比较



#### 配置



#### 工作原理



#### 集群选举原理



#### Redis集群通信方式



##### 集中式



##### gossip





#### 集群脑裂

网络恢复之后，原master节点变成slave节点，从新master节点同步数据导致原master上面的数据丢失。可以通过以下配置避免脑裂问题：

~~~shell
min-slaves-to-write 1 #值=集群数量/2+1
~~~



### 知识点

1. master主节点内存不适宜过大（一般10G），持久化文件过大影响数据恢复和主从同步效率。（主从复制风暴）。
2. Cluster集群模式下，redis小集群中的master主节点提供读写，slave从节点提供数据冗余和被选举为master功能。
3. 错峰主从
4. CRC16算法对key进行hash运算并取模16384，计算出slot槽位。
5. redis底层通过Socket将命令以“resp”协议发送到服务端；

