---
title: Zookeeper使用场景
date: 2021-4-14 16:23:57 +0800
categories: [分布式, Zookeeper]
tags: [分布式, Zookeeper, 使用场景]
math: true
image: 
---

### ZK非公平锁/公平锁/共享锁

#### 非公平锁

##### 缺点

当监听的连接比较多时，当锁被释放时，会造成“羊群效应”，或者叫“惊群效应”，大量的连接同时发送创建请求，会对Zookeeper造成很大压力。



#### 公平锁

##### 幽灵节点

- 描述

  client创建节点时到server，server成功创建节点，但server通知client时，client挂掉，导致client无法感知已经创建的节点。

- 解决

  创建key时加一个UUID唯一标识作为前缀，缓存在client中，再连接重试时，加上前缀去查看节点是否存在，这样就能感知到“幽灵节点”。

#### 共享锁

以上两种锁都是“互斥锁”或者叫“独占锁”，这种锁无法解决以下问题：

1. 读写并发不一致
2. 双写不一致

读写锁/共享锁可以解决以上问题：

> 当写比较频繁时，读写锁效率并不高。

读写锁

### Leader选举在分布式场景中的应用

例如缓存预热，需要从集群中的服务节点选出一个节点去执行，这时候就可以使用Leader选举来实现。



### Zookeeper注册中心